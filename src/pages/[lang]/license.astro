---
import { type CollectionEntry, getEntry, render } from "astro:content";
import Markdown from "@components/misc/Markdown.astro";
import { isSupportedLanguage } from "@utils/i18n-utils";
import { siteConfig } from "../../config";
import MainGridLayout from "../../layouts/MainGridLayout.astro";

export async function getStaticPaths() {
	const supportedLangs = siteConfig.supportedLangs || ["en"];
	const defaultLang = siteConfig.defaultLang || siteConfig.lang || "zh_cn";
	return supportedLangs
		.filter((lang) => lang !== defaultLang)
		.map((lang) => ({ params: { lang }, props: { lang } }));
}

const { lang } = Astro.params;
if (!isSupportedLanguage(lang)) {
	return Astro.redirect("/404");
}

let licensePost: CollectionEntry<"spec"> | undefined;
try {
	// try language-specific spec: license_{lang}.md
	licensePost = await getEntry("spec", `license_${lang}`);
	if (!licensePost) {
		licensePost = await getEntry("spec", "license");
	}
} catch {
	licensePost = await getEntry("spec", "license");
}

const Content = licensePost ? (await render(licensePost)).Content : undefined;
---
<MainGridLayout title="License" description="License" lang={lang}>
  <div class="flex w-full overflow-hidden relative min-h-32">
    <div class="card-base z-10 px-9 py-6 relative w-full ">
      <Markdown class="mt-2">
        {Content && <Content />}
      </Markdown>
    </div>
  </div>
</MainGridLayout>

