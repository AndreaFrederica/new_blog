---
import License from "@components/misc/License.astro";
import Markdown from "@components/misc/Markdown.astro";
import PostMetadata from "@components/PostMeta.astro";
import MainGridLayout from "@layouts/MainGridLayout.astro";
import { getNotesWithFallback } from "@utils/content-utils.ts";
import type { APIContext } from "astro";
import { getLicenseConfig } from "src/config";

export async function getStaticPaths() {
	const notes = await getNotesWithFallback();
	return notes.map((entry) => ({
		params: { slug: entry.slug },
		props: { entry },
	}));
}

import type { NoteEntry } from "@/types/content";

const { entry } = Astro.props as { entry: NoteEntry };
const { Content, headings } = await entry.render();
// tags 已在 helper 中保证包含“随笔”
const noteTags: string[] = Array.isArray(entry.data.tags)
	? [...entry.data.tags]
	: [];
const licenseObj = getLicenseConfig(entry.data.lang || "zh_cn");
---
<MainGridLayout title={entry.data.title} description={entry.data.description} lang={entry.data.lang} setOGTypeArticle={true} headings={headings} scope="notes">
  <div class="flex w-full overflow-hidden relative mb-4">
    <div id="note-container" class="card-base z-10 px-6 md:px-9 pt-6 pb-6 relative w-full">
      <div class="relative onload-animation">
        <div class="transition w-full block font-bold mb-3 text-3xl md:text-[2.25rem]/[2.75rem] text-black/90 dark:text-white/90 md:before:w-1 before:h-5 before:bg-[var(--primary)] before:absolute before:top-[0.75rem] before:left-[-1.125rem]">
          {entry.data.title}
        </div>
      </div>

      <div class="onload-animation">
  <PostMetadata class="mb-5" published={entry.data.published ?? new Date(0)} updated={entry.data.updated} tags={noteTags} category={entry.data.category} categoryUrlBase="notes" licenseName={entry.data.license} licenseUrl={entry.data.licenseUrl} lang={entry.data.lang} />
        <div class="border-[var(--line-divider)] border-dashed border-b-[1px] mb-5"></div>
      </div>

      <Markdown class="mb-6 markdown-content onload-animation">
        <Content />
      </Markdown>

  {licenseObj.enable && <License title={entry.data.title} slug={entry.slug} pubDate={entry.data.published ?? new Date(0)} lang={entry.data.lang} license={entry.data.license} licenseName={entry.data.license} licenseUrl={entry.data.licenseUrl} class="mb-6 license-container onload-animation" />}
    </div>
  </div>
</MainGridLayout>
