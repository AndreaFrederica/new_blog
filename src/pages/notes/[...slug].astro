---
import type { APIContext } from "astro";
import { getCollection } from "astro:content";
import Markdown from "@components/misc/Markdown.astro";
import MainGridLayout from "@layouts/MainGridLayout.astro";
import PostMetadata from "@components/PostMeta.astro";
import License from "@components/misc/License.astro";
import { licenseConfig } from "src/config";

export async function getStaticPaths() {
  const notes = await getCollection("notes");
  return notes.map((entry) => ({ params: { slug: entry.slug }, props: { entry } }));
}

const { entry } = Astro.props as { entry: any };
const { Content, headings } = await entry.render();
// ensure tag "随笔"
const noteTags: string[] = Array.isArray(entry.data.tags) ? [...entry.data.tags] : [];
if (!noteTags.includes('随笔')) noteTags.push('随笔');
---
<MainGridLayout title={entry.data.title} description={entry.data.description} lang={entry.data.lang} setOGTypeArticle={true} headings={headings} scope="notes">
  <div class="flex w-full overflow-hidden relative mb-4">
    <div id="note-container" class="card-base z-10 px-6 md:px-9 pt-6 pb-6 relative w-full">
      <div class="relative onload-animation">
        <div class="transition w-full block font-bold mb-3 text-3xl md:text-[2.25rem]/[2.75rem] text-black/90 dark:text-white/90 md:before:w-1 before:h-5 before:bg-[var(--primary)] before:absolute before:top-[0.75rem] before:left-[-1.125rem]">
          {entry.data.title}
        </div>
      </div>

      <div class="onload-animation">
        <PostMetadata class="mb-5" published={entry.data.published} updated={entry.data.updated} tags={noteTags} category={entry.data.category} categoryUrlBase="notes" />
        <div class="border-[var(--line-divider)] border-dashed border-b-[1px] mb-5"></div>
      </div>

      <Markdown class="mb-6 markdown-content onload-animation">
        <Content />
      </Markdown>

      {licenseConfig.enable && <License title={entry.data.title} slug={entry.slug} pubDate={entry.data.published} lang={entry.data.lang} class="mb-6 license-container onload-animation" />}
    </div>
  </div>
</MainGridLayout>
